{
    "collab_server" : "",
    "contents" : "# First 20-something graphs at @MMAGraphs on Twitter. Not organized well!\n\nufc <- read.csv(\"UFCMaster.csv\")\nunique(ufc$Event, ufc$Date)\n\nUFCProcess <- function(df){\n  require(lubridate)\n  df$fight.id <- as.character(df$fight.id)\n  df$round <- as.factor(df$round)\n  df$time <- as.character(df$time)\n  df$weight.class.id <- as.factor(df$weight.class.id)\n  df$date <- as.Date(df$date, \"%m/%d/%y\")\n  df$year <- year(df$date)\n  df$month <- month(df$date)\n  df$day <- day(df$date)\n  df$minute <- as.integer(substr(df$time, 1, 1))\n  df$second <- as.integer(substr(df$time, 3, 4))\n  df$round.seconds <- df$minute * 60 + df$second\n  df$fight.seconds <- (as.integer(df$round) - 1) * 300 + df$round.seconds\n  df$title.fight <- as.factor(df$title.fight)\n  df$five.rounds <- as.factor(df$five.rounds)\n  df$gender <- as.factor(ifelse(df$weight.class.id == 24 | \n                                df$weight.class.id == 25 |\n                                df$weight.class.id == 32 | \n                                df$weight.class.id == 88, \"Female\", \"Male\"))\n  return(df)\n}\n\nufc <- UFCProcess(ufc)\n\nvector <- rep(0, nrow(ufc))\nevents <- unique(ufc$Event)\nevents\n\nFightsOnCard <- function(event){\n  vector <- as.numeric(ufc$Event == event)\n  return(sum(vector))\n}\n\nevents.fights <- sapply(events, FUN = FightsOnCard)\nevents.fights\n\nevents.fights.total <- sapply(events.fights, FUN = seq)\nufc$matchOrder <- unlist(events.fights.total, recursive = TRUE, use.names = TRUE)\nevent.dates <- ufc[c(\"event\", \"date\")]\nevent.dates <- unique(event.dates)\nevent.dates[duplicated(event.dates$date), ]\n\nufc$date <- as.Date(ufc$date, \"%m/%d/%y\")\nufc$year <- year(ufc$date)\nufc$month <- month(ufc$date)\nufc$day <- day(ufc$date)\n\nmonths <- ifelse(ufc$month > 9, as.character(ufc$month), paste0(0, ufc$month))\ndays <- ifelse(ufc$day > 9, as.character(ufc$day), paste0(0, ufc$day))\nfight.order <- ifelse(ufc$fight.order > 9, as.character(ufc$fight.order), paste0(0, ufc$fight.order))\nufc.fight.id <- paste0(\"UFC\", ufc$year, months, days, fight.order)\nufc$fight.id <- ufc.fight.id\nwrite.csv(ufc, file = \"UFCtemp.csv\")\nufc <- read.csv(\"UFCtemp.csv\")\n\nufc$minute <- as.integer(substr(ufc$time, 1, 1))\nufc$second <- as.integer(substr(ufc$time, 3, 4))\nufc$round.seconds <- ufc$minute * 60 + ufc$second\nufc$fight.seconds <- (ufc$round - 1) * 300 + ufc$round.seconds\nufc$weight.class.id <- as.factor(ufc$weight.class.id)\n\nufc %>%\n  filter(., as.integer(weight.class.id) < 9) %>%\n  group_by(weight.class.id) %>%\n  summarize(\n    average.time = mean(fight.seconds)\n  ) %>%\n  ggplot(., aes(weight.class.id, average.time, fill = weight.class.id)) +\n  ylab(\"Average Fight Time (Seconds)\") +\n  scale_x_discrete(labels=c(\"1\" = \"Heavyweight\", \"2\" = \"Light Heavyweight\", \"3\" = \"Middleweight\",\n                            \"4\" = \"Middleweight\", \"5\" = \"Lightweight\", \"6\" = \"Featherweight\",\n                            \"7\" = \"Bantamweight\", \"8\" = \"Flyweight\")) +\n  coord_flip() +\n  geom_col() +\n  theme(legend.position = \"none\", axis.title.y = element_blank())\n\n  \n\nufc$title.fight <- 0\nufc$five.rounds <- 0\n\nfilter(ufc, weight.class.id == 14)\n\nufc$title.fight[ufc$winner == \"Brock Lesnar\" & ufc$event == \"UFC 100\"] <- 1\nufc <- read.csv(\"UFCtemp.csv\")\n\nufc <- read.csv(\"MasterUFCJuly.csv\")\n\n\n# percentage of male/female fights over time\nufc %>%\n  filter(year > 2011) %>%\n  group_by(year) %>%\n  summarize(\n    n = length(year),\n    male = sum(gender == \"Male\"),\n    male_pct = male / n,\n    female_pct = 1 - male_pct\n  ) %>%\n  ggplot(.) +\n    geom_line(aes(x = year, y = male_pct), color = \"blue\") +\n    geom_line(aes(x = year, y = female_pct), color = \"orange\")\n\n# graph of ufc fights by gender frequency\nufc %>%\n  filter(year > 2011) %>%\n  ggplot(aes(x = factor(year), fill = gender)) +\n    geom_bar(position = \"fill\") +\n    ylab(\"Frequency\") +\n    xlab(\"Year\") +\n    labs(title = \"Frequency of UFC fights by gender\", \n         subtitle = \"Thru July 11, 2007\") +\n    theme(legend.title = element_blank()) +\n    theme_minimal()\n\n# number of headlining bouts per weight class\nufc %>%\n  filter(fight.order == 1, year > 2012) %>%\n  ggplot(aes(x = weight.class.id, fill = gender)) +\n    geom_bar() +\n    theme_minimal() + \n    scale_x_discrete(labels=c(\"1\" = \"HW\", \"2\" = \"LHW\", \"3\" = \"MW\", \"4\" = \"WW\",\n                              \"5\" = \"LW\", \"6\" = \"FW\", \"7\" = \"BW\", \"8\" = \"FL\",\n                              \"24\" = \"FW\", \"25\" = \"BW\", \"32\" = \"SW\",\n                              \"88\" = \"CW\", \"11\" = \"CW\")) +\n    theme(axis.text.x = element_text(angle=45),\n          axis.title.x = element_blank(), \n          axis.title.y = element_blank(),\n          legend.title = element_blank()) +\n    labs(title = \"Number of headlining bouts per weight class (UFC)\", \n         subtitle = \"2013 - July 12, 2017\")\n\n\n# graph of a weight class' percentage of headlining bouts in the ufc since 2013\nufc %>%\n  filter(year > 2012, (as.integer(weight.class.id) < 9 |\n                       as.integer(weight.class.id) == 13 |\n                       as.integer(weight.class.id) == 15)) %>%\n  group_by(weight.class.id, gender) %>%\n  summarize(\n    n = length(weight.class.id),\n    head = sum(fight.order == 1),\n    pct.head = head / n\n  ) %>%\n  ggplot(aes(x = weight.class.id, y = pct.head, fill = gender)) +\n    geom_col() +\n    theme_minimal() + \n    scale_x_discrete(labels=c(\"1\" = \"HW\", \"2\" = \"LHW\", \"3\" = \"MW\", \"4\" = \"WW\",\n                              \"5\" = \"LW\", \"6\" = \"FW\", \"7\" = \"BW\", \"8\" = \"FL\",\n                              \"24\" = \"FW\", \"25\" = \"BW\", \"32\" = \"SW\",\n                              \"88\" = \"CW\", \"11\" = \"CW\")) +\n    theme(axis.text.x = element_text(angle=45),\n          axis.title.x = element_blank(), \n          axis.title.y = element_blank(),\n          legend.title = element_blank()) +\n    labs(title = \"Percentage of weight class bouts that have headlined UFC event\", \n         subtitle = \"2013 - July 13, 2017\")\n\nNumberOfFighters <- function(start.year = 1990, end.year = 9999, df = ufc){\n  xdf = filter(df, year > start.year & year < end.year)\n  winner <- xdf %>%\n    select(fighter = winner, year = year) %>%\n    group_by(fighter, year) %>%\n    summarize(\n      wins = n(),\n      losses = 0\n    )\n  loser <- xdf %>%\n    select(fighter = loser, year = year) %>%\n    group_by(fighter, year) %>%\n    summarize(\n      wins = 0,\n      losses = n()\n    )\n  total <- full_join(winner, loser, by = c(\"fighter\", \"year\"))\n  total[is.na(total)] <- 0\n  total <- select(total, fighter, year, wins = wins.x, losses = losses.y)\n  total$fights <- total$wins + total$losses\n  total <- arrange(total, fighter)\n  total\n}\n\ntest <- NumberOfFighters()\n\ntest %>% filter(year > 2000 & year < 2017) %>%\n  group_by(year) %>%\n  summarize(\n    fighters = n()\n  ) %>%\n  ggplot(aes(x = factor(year), y = fighters)) +\n    geom_col() +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle=45),\n          axis.title.x = element_blank()) +\n    labs(title = \"Number of fighters to appear in the UFC\",\n         y = \"Fighters\")\n\nunique(factor(ufc$method))\n    \n# Finish rate in UFC year-by-year  \nfilter(ufc, method != \"DQ\" & method != \"No Contest\", year > 2000) %>%\n  mutate(finish = ifelse(method == \"KO/TKO\" | method == \"Submission\" |\n                         method == \"TKO - Doctor's Stoppage\", 1, 0)) %>%\n  group_by(year) %>%\n  summarise(\n    fights = n(),\n    finishes = sum(finish),\n    finish.rate = finishes / fights\n  ) %>%\n  ggplot(aes(x = factor(year), y = finish.rate, group = 1)) +\n    geom_line() +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle=45, vjust = -0.00005),\n          axis.title.x = element_blank(),\n          axis.title.y = element_blank(),\n          plot.margin = unit(c(6.5, 5.5, 10.5, 5.5), \"points\")) +\n    labs(title = \"UFC stoppage rate\",\n         subtitle = \"Through July 17, 2017\") +\n   scale_y_continuous(limits = c(0, 1), labels = scales::percent)\n\n# Percentage difference in UFC finish rate year by year\nfilter(ufc, method != \"DQ\" & method != \"No Contest\", year > 2000) %>%\n  mutate(finish = ifelse(method == \"KO/TKO\" | method == \"Submission\" |\n                         method == \"TKO - Doctor's Stoppage\", 1, 0)) %>%\n  group_by(year) %>%\n  summarise(\n    fights = n(),\n    finishes = sum(finish),\n    finish.rate = finishes / fights\n  ) %>%\n  mutate(rate.diff = finish.rate / lag(finish.rate, 1) - 1) %>%\n  na.omit() %>%\n  ggplot(aes(x = factor(year), y = rate.diff, group = 1)) +\n    geom_line() +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle=45, vjust = -0.00005),\n          axis.title.x = element_blank(),\n          axis.title.y = element_blank(),\n          plot.margin = unit(c(6.5, 5.5, 10.5, 5.5), \"points\")) +\n    labs(title = \"UFC stoppage rate, % difference relative to prior year\",\n         subtitle = \"Through July 17, 2017\") +\n    scale_y_continuous(labels = scales::percent)\n      \n# UFC finishing rates by weight class\nfilter(ufc, method != \"DQ\" & method != \"No Contest\", year > 2000) %>%\n  mutate(finish = ifelse(method == \"KO/TKO\" | method == \"Submission\" |\n                           method == \"TKO - Doctor's Stoppage\", 1, 0),\n         weight.group = ifelse(as.integer(weight.class.id) %in% 1:4, 1, \n                               ifelse(as.integer(weight.class.id) %in% 5:8, 2,\n                                      ifelse(as.integer(weight.class.id) %in% 12:15, 3,\n                                             0)))) %>%\n  filter(weight.group != 0) %>%\n  group_by(year, weight.group) %>%\n  summarise(\n    fights = n(),\n    finishes = sum(finish),\n    finish.rate = finishes / fights\n  ) %>%\n  ggplot(aes(x = factor(year), y = finish.rate, group = factor(weight.group),\n             color = factor(weight.group))) +\n  geom_line() +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle=45, vjust = -0.00005),\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        plot.margin = unit(c(6.5, 5.5, 10.5, 5.5), \"points\")) +\n  labs(title = \"UFC stoppage rate\",\n       subtitle = \"Through July 17, 2017\") +\n  scale_y_continuous(limits = c(0, 1), labels = scales::percent)\n\nfilter(ufc, method != \"DQ\" & method != \"No Contest\", year > 2000,\n       weight.class.id != 11, weight.class.id != 22,\n       weight.class.id != 24, weight.class.id != 26, \n       weight.class.id != 88) %>%\n  mutate(finish = ifelse(method == \"KO/TKO\" | method == \"Submission\" |\n                           method == \"TKO - Doctor's Stoppage\", 1, 0)) %>%\n  group_by(year, weight.class) %>%\n  summarise(\n    fights = n(),\n    finishes = sum(finish),\n    finish.rate = finishes / fights\n  ) %>%\n  ggplot(aes(x = factor(year), y = finish.rate, group = 1)) +\n    geom_line() +\n    facet_wrap(~weight.class) +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle=45, vjust = -0.00005),\n          axis.title.x = element_blank(),\n          axis.title.y = element_blank(),\n          plot.margin = unit(c(6.5, 5.5, 10.5, 5.5), \"points\")) +\n    labs(title = \"UFC stoppage rate by weight class\",\n         subtitle = \"Through July 18, 2017\") +\n    scale_y_continuous(limits = c(0, 1), labels = scales::percent)\n\n\n# Rate of KO/TKO vs. Submission vs. Decision\nmethod.df <- select(ufc, method, year) %>%\n  filter(method != \"DQ\" & method != \"No Contest\", year > 2000) %>%\n  mutate(finish = as.factor(ifelse(method == \"KO/TKO\" | \n                            method == \"TKO - Doctor's Stoppage\", \"KO/TKO\",\n                            ifelse(method == \"Submission\", \"Submission\", \n                                   \"Decision\")))) %>%\n  group_by(year, finish) %>%\n  summarize(\n    count = n()\n  )\n\ntko <- filter(method.df, finish == \"KO/TKO\")$count\nsub <- filter(method.df, finish == \"Submission\")$count\ndec <- filter(method.df, finish == \"Decision\")$count\n\nfinishes <- as.data.frame(matrix(c(2001:2017, tko, sub, dec), nrow = 17, ncol = 4))\ncolnames(finishes) <- c(\"year\", \"tko\", \"sub\", \"dec\")\nfinishes$tko.pct <- with(finishes, tko / (tko + sub + dec))\nfinishes$sub.prt <- with(finishes, sub / (tko + sub + dec))\nfinishes$dec.pct <- with(finishes, dec / (tko + sub + dec))\nfinishes\nwith(finishes, tko.pct + sub.pct + dec.pct)\nggplot(data = finishes) +\n  geom_line(aes(x = factor(year), y = tko.pct, group = 1, color = \"red\")) +\n  geom_line(aes(x = factor(year), y = sub.pct, group = 1, color = \"blue\")) +\n  geom_line(aes(x = factor(year), y = dec.pct, group = 1, color = \"darkgreen\")) +\n  theme_minimal() +\n  scale_y_continuous(limits = c(0, 1), labels = scales::percent) + \n  theme(axis.text.x = element_text(angle=45),\n        axis.title.y = element_blank()) +\n  xlab(\"Year\") +\n  labs(title = \"Rate of fight-ending methods in UFC\",\n       subtitle = \"2001 - July 19, 2017\",\n       color = \"Method\") +\n  scale_color_manual(labels = c(\"Submission\", \"Decision\", \"KO/TKO\"),\n                     values = c(\"blue\", \"darkgreen\", \"red\"))\n\n# bar chart of UFC headlining weight class\n\nfilter(ufc, \n       weight.class != \"Men's Catchweight\" & \n       weight.class != \"Super Heavyweight\" &\n       weight.class != \"Old Middleweight\" &\n       weight.class != \"Women's Featherweight\" &\n       weight.class != \"Women's Flyweight\" &\n       weight.class != \"Women's Catchweight\") %>%\n  droplevels() %>%\n  filter(substring(as.character(event), 1, 10) == \"UFC on Fox\",\n         fight.order == 1) %>%\n  ggplot(aes(x = weight.class, fill = gender)) + geom_bar() +\n    theme_minimal() +\n    theme(axis.text.x = element_text(angle = 15),\n          axis.title.y = element_blank(),\n          axis.title.x = element_blank(),\n          legend.title = element_blank()) +\n  scale_x_discrete(drop = FALSE) +\n    labs(title = \"UFC on Fox main events by weight class\",\n         subtitle = \"UFC on Fox 1 through 24\")\n\n# Length of UFC on Fox main cards\nfilter(ufc, substring(as.character(event), 1, 10) == \"UFC on Fox\", \n       fight.order < 5, date > \"2012-02-01\") %>%\n  select(event, fight.seconds) %>%\n  group_by(event) %>%\n  summarize(\n    main.card.total = sum(fight.seconds) / 60\n  ) %>%\n  ggplot() +\n    geom_histogram(aes(x = main.card.total), binwidth = 5,\n                   color = \"black\", fill = \"gray\") +\n  theme_minimal() + \n  theme(plot.title = element_text(size = 12)) + \n  xlab (\"Fight time (in minutes)\") +\n  ylab(\"Count\") +\n  labs(title = \"Combined fight length of UFC on Fox main cards\",\n        subtitle = \"UFC on Fox 3 through 24\") +\n  scale_x_continuous(breaks = seq(20, 70, 5))\n\n# Jon Jones winning LHW title fights\nfilter(ufc, weight.class.id == 2, title.fight == 1) %>%\n  mutate(jon.jones = ifelse(winner == \"Jon Jones\", 1, 0)) %>%\n  ggplot(aes(x = factor(1), fill = factor(jon.jones))) +\n    geom_bar(width = 1) +\n    coord_polar(theta = \"y\") +\n    scale_fill_manual(labels = c(\"Not Jon Jones\", \"Jon Jones\"), \n                      values = c(\"orange\", \"black\")) + \n    theme(legend.title = element_blank(),\n          axis.title.y = element_blank(),\n          axis.title.x = element_blank()) +\n    labs(title = \"Winners in UFC light heavyweight title fights\",\n         subtitle = \"Includes UFC 31 to UFC on Fox 25\")\n\n\n# Finish types in UFC title fights (Jon Jones vs. others)\nfilter(ufc, weight.class.id == 2, title.fight == 1) %>%\n  mutate(jon.jones = as.factor(ifelse(winner == \"Jon Jones\", 1, 0))) %>%\n  mutate(finish = as.factor(ifelse(method == \"KO/TKO\" | \n                                     method == \"TKO - Doctor's Stoppage\", \"KO/TKO\",\n                                   ifelse(method == \"Submission\", \"Submission\", \n                                          \"Decision\")))) %>%\n  ggplot(aes(x = finish, fill = jon.jones)) +\n  geom_bar() +\n  scale_fill_manual(labels = c(\"Not Jon Jones\", \"Jon Jones\"), \n                    values = c(\"orange\", \"black\")) + \n  theme(legend.title = element_blank(),\n        axis.title.y = element_blank(),\n        axis.title.x = element_blank(),\n        legend.position=\"bottom\") +\n  labs(title = \"Finishes in UFC light heavyweight title fights\",\n       subtitle = \"Includes UFC 31 to UFC on Fox 25\")\n\n(ugh <- c(8, 7, 16, 6, 5, 15, 4, 14, 3, 2, 13, 12, 1, seq(11, 1)))\n\n# Plot of Jones and Cormier UFC wins\nselect(ufc, winner, date) %>%\n  filter(winner == \"Jon Jones\" | winner == \"Daniel Cormier\") %>%\n  mutate(ufc.win = ugh) %>%\n  arrange(date)\n  ggplot(aes(x = date, y = ufc.win, color = winner)) +\n    geom_line() +\n    geom_point() +\n    scale_y_continuous(breaks = seq(1, 16)) +\n    scale_x_date(breaks = date_breaks(\"years\"), labels = date_format(\"%Y\")) +\n    theme_bw() +\n    theme(legend.title = element_blank(),\n        axis.title.y = element_blank(),\n        axis.title.x = element_blank(),\n        legend.position=\"bottom\",\n        plot.title = element_text(size = 12)) +\n    labs(title = \"Cumulative UFC wins (Jon Jones, Daniel Cormier)\",\n         subtitle = \"Through July 27, 2017\")\n\nlawcer <- select(ufc, winner, date) %>%\n  filter(winner == \"Robbie Lawler\" | winner == \"Donald Cerrone\") %>%\n  arrange(winner, date)\n\nlawcer$ufc.win = sequence(rle(as.character(lawcer$winner))$lengths) \n  \nggplot(data = lawcer, aes(x = date, y = ufc.win, color = winner)) +\n  geom_line() +\n  geom_point() +\n  scale_y_continuous(breaks = seq(1, 20)) +\n  scale_x_date(breaks = date_breaks(\"years\"), labels = date_format(\"%Y\")) +\n  theme_bw() +\n  theme(legend.title = element_blank(),\n        axis.text.x = element_text(angle = 90),\n        axis.title.y = element_blank(),\n        axis.title.x = element_blank(),\n        legend.position=\"bottom\",\n        plot.title = element_text(size = 12)) +\n  labs(title = \"Cumulative UFC wins (Robbie Lawler, Donald Cerrone)\",\n       subtitle = \"Through July 27, 2017\")\n\nwoomai <- select(ufc, winner, date) %>%\n  filter(winner == \"Tyron Woodley\" | winner == \"Demian Maia\") %>%\n  arrange(winner, date)\n\nwoomai$ufc.win = sequence(rle(as.character(woomai$winner))$lengths) \n    \nggplot(data = woomai, aes(x = date, y = ufc.win, color = winner)) +\n  geom_line() +\n  geom_point() +\n  scale_y_continuous(breaks = seq(1, 20)) +\n  scale_x_date(breaks = date_breaks(\"years\"), labels = date_format(\"%Y\")) +\n  theme_bw() +\n  theme(legend.title = element_blank(),\n        axis.text.x = element_text(angle = 90),\n        axis.title.y = element_blank(),\n        axis.title.x = element_blank(),\n        legend.position=\"bottom\",\n        plot.title = element_text(size = 12)) +\n  labs(title = \"Cumulative UFC wins (Tyron Woodley, Demian Maia)\",\n       subtitle = \"Through July 28, 2017\")\n\n\n### Most UFC title wins\n\nfilter(ufc, title.fight == 1) %>%\n  select(winner) %>%\n  group_by(winner) %>%\n  summarise(\n    title.wins = n()\n  ) %>%\n  arrange(desc(title.wins)) %>%\n  filter(title.wins > 5) %>%\n  ggplot(aes(x = reorder(winner, title.wins), y = title.wins)) + \n    geom_bar(stat = \"identity\", fill = \"goldenrod3\") +\n  coord_flip() +\n  scale_y_continuous(breaks = seq(1, 12)) +\n  ylab(\"Wins\") +\n  theme_bw() +\n  theme(axis.title.y = element_blank()) +\n  labs(title = \"Wins in UFC title fights\",\n       subtitle = \"UFC 31 through UFC 214\")\n# Most finishes in UFC title fights\nfilter(ufc, title.fight == 1, method == \"KO/TKO\" | method == \"Submission\" |\n                              method == \"TKO - Doctor's Stoppage\") %>%\n  select(winner) %>%\n  group_by(winner) %>%\n  summarise(\n    title.wins = n()\n  ) %>%\n  arrange(desc(title.wins)) %>%\n  filter(title.wins > 3) %>%\n  ggplot(aes(x = reorder(winner, title.wins), y = title.wins)) + \n  geom_bar(stat = \"identity\", fill = \"goldenrod3\") +\n  coord_flip() +\n  scale_y_continuous(breaks = seq(1, 12)) +\n  ylab(\"Wins\") +\n  theme_bw() +\n  theme(axis.title.y = element_blank()) +\n  labs(title = \"Finishes in UFC title fights\",\n       subtitle = \"UFC 28 through UFC 214\")\n  \n# Rashad Evans position on card\n\nrashad <- filter(ufc, winner == \"Rashad Evans\" | loser == \"Rashad Evans\") %>%\n  select(winner, loser, fight.order)\n\nrashad$fight <- 21:1\nrashad$fight.order = 1 - rashad$fight.order\n\nggplot(rashad, aes(x = fight, y = fight.order)) + \n  geom_line() +\n  geom_point() +\n  theme_bw() +\n  xlab(\"Career fight number\") +\n  ylab(\"Fights away from main event\") +\n  labs(title = \"Rashad Evans' position on UFC cards\")\n\ntest.df <- filter(ufc, title.fight == 1, method == \"KO/TKO\" | method == \"Submission\" |\n                    method == \"TKO - Doctor's Stoppage\") %>%\n  select(winner) %>%\n  group_by(winner) %>%\n  summarise(\n    title.wins = n()\n  ) %>%\n  arrange(desc(title.wins))\nprint(tbl_df(test.df), n=54)\n\n# Evans, Alvey cumulative UFC wins\nevaalv <- select(ufc, winner, date) %>%\n  filter(winner == \"Rashad Evans\" | winner == \"Sam Alvey\") %>%\n  arrange(winner, date)\n\nevaalv$ufc.win = sequence(rle(as.character(evaalv$winner))$lengths) \n\nggplot(data = evaalv, aes(x = date, y = ufc.win, color = winner)) +\n  geom_line() +\n  geom_point() +\n  scale_y_continuous(breaks = seq(1, 20)) +\n  scale_x_date(breaks = date_breaks(\"years\"), labels = date_format(\"%Y\")) +\n  theme_bw() +\n  theme(legend.title = element_blank(),\n        axis.text.x = element_text(angle = 90),\n        axis.title.y = element_blank(),\n        axis.title.x = element_blank(),\n        legend.position=\"bottom\",\n        plot.title = element_text(size = 12)) +\n  labs(title = \"Cumulative UFC wins (Rashad Evans, Sam Alvey)\",\n       subtitle = \"Through August 3, 2017\")\n\n# Most UFC wins in Mexico\nmexico <- filter(ufc, date == \"2014-11-15\" | date == \"2015-06-13\" | date == \"2015-11-21\" |\n            date == \"2016-11-05\")\n\nNumberOfFights <- function(df = ufc){\n  winner <- df %>%\n    select(fighter = winner) %>%\n    group_by(fighter) %>%\n    summarize(\n      wins = n(),\n      losses = 0\n    )\n  loser <- df %>%\n    select(fighter = loser) %>%\n    group_by(fighter) %>%\n    summarize(\n      wins = 0,\n      losses = n()\n    )\n  total <- full_join(winner, loser, by = \"fighter\")\n  total[is.na(total)] <- 0\n  total <- select(total, fighter, wins = wins.x, losses = losses.y)\n  total$fights <- total$wins + total$losses\n  total <- arrange(total, desc(fights), desc(wins))\n  total\n}\n\nmexico.test <- NumberOfFights(mexico)\nmexico.test$fighter <- factor(mexico.test$fighter)\nmexico.test$fighter <- reorder(mexico.test$fighter, mexico.test$wins)\nmexico.test <- filter(mexico.test, wins > 1)\nimg <- readPNG(\"MexicoFlag2.png\")\n\nggplot(mexico.test, aes(x = fighter, y = wins)) +\n  geom_bar(stat = \"identity\", fill = \"green4\", alpha = 0.8) + \n  theme_bw() +\n  coord_flip() +\n  theme(axis.title.y = element_blank(),\n        axis.title.x = element_blank(),\n        legend.position = \"none\",\n        panel.grid = element_blank()) +\n  labs(title = \"Most UFC wins in Mexico\")\n\n# mean fights per card by year\nufc %>%\n  group_by(event, year) %>%\n  summarize(\n    fights.on.card = max(fight.order)\n  ) %>%\n  group_by(year) %>%\n  summarize(\n    avg.num.fights = mean(fights.on.card)\n  ) %>%\n  ggplot(aes(x = year, y = avg.num.fights)) +\n    geom_line() +\n    geom_point() +\n    scale_y_continuous(breaks = seq(0, 13)) +\n    coord_cartesian(ylim = c(0, 13)) +\n    scale_x_continuous(breaks = seq(2000, 2017)) +\n    theme_bw() +\n    ylab(\"Fights\") +\n    labs(title = \"Average number of fights per UFC card\",\n         subtitle = \"UFC 28 through UFC Fight Night 114\") +\n    theme(axis.title.x = element_blank(),\n          axis.text.x = element_text(angle=90),\n          panel.grid.minor = element_blank())\n\n# average length of fight cards \nufc %>%\n  group_by(event, year) %>%\n  summarize(\n    card.minutes = sum(fight.seconds) / 60\n  ) %>%\n  group_by(year) %>%\n  summarize(\n    avg.card.minutes = mean(card.minutes)\n  ) %>%\n  ggplot(aes(x = year, y = avg.card.minutes)) +\n    geom_line() +\n    geom_point() +\n    scale_y_continuous(breaks = seq(0, 140, 20)) +\n    coord_cartesian(ylim = c(0, 140)) +\n    scale_x_continuous(breaks = seq(2000, 2017)) +\n    theme_bw() +\n    ylab(\"Minutes\") +\n    labs(title = \"Average total fight length of UFC cards\",\n         subtitle = \"UFC 28 through UFC Fight Night 114\") +\n    theme(axis.title.x = element_blank(),\n          axis.text.x = element_text(angle = 90),\n          panel.grid.minor = element_blank())\n\n\n# event types\nufc.events$type <- ifelse(grepl(\"\\\\<on Fox\\\\>\", unique(ufc$event)), \n                          \"Network\",\n                          ifelse(grepl(\"UFC [[:digit:]]\", unique(ufc$event)), \"PPV\", \n                                 \"Cable\"))\nufc.events$type <- ifelse(grepl(\"UFC 70|UFC 89|UFC 95|UFC 105|UFC 120|UFC 138\", ufc.events$event),\n                          \"Cable\", \n                          ifelse(grepl(\"UFC 37.5\", ufc.events$event), \"Taped\", ufc.events$type))\n\n# heatmap of events per month\nufc.events.month <- filter(ufc, year < 2017, year > 2000) %>%\n  distinct(event, month, year) %>%\n  group_by(month, year) %>%\n  summarize(\n    num.events = n()\n  ) %>%\n  arrange(year, month) %>%\n  print(n = 162)\n\nblank <- data.frame(rep(1:12, times = 16), rep(2001:2016, each = 12), 0)\ncolnames(blank) <- c(\"month\", \"year\", \"num.events\")\n\nufc.events.heatmap <- left_join(blank, ufc.events.month, by = c(\"month\", \"year\"))\nufc.events.heatmap$num.events <-\n  ifelse(is.na(ufc.events.heatmap$num.events.y), ufc.events.heatmap$num.events.x,\n         ufc.events.heatmap$num.events.y)\n\nggplot(ufc.events.heatmap, aes(y = year, x = month)) +\n  geom_tile(aes(fill = num.events)) +\n  scale_fill_gradient(name = \"# of events\",\n                      low = \"blue4\", high = \"firebrick2\") +\n  theme_bw() + \n  scale_x_continuous(breaks = seq(1, 12), \n                     labels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n                                \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")) +\n  scale_y_continuous(breaks = seq(2001, 2016)) +\n  theme(axis.text.x = element_text(angle=90),\n        axis.title = element_blank()) +\n  labs(title = \"Number of UFC events by month\")\n\nggplot(ufc.events.heatmap, aes(y = year, x = month)) +\n  geom_tile(aes(fill = factor(num.events))) +\n  scale_fill_discrete(name = \"# of events\") +\n  theme_bw() + \n  scale_x_continuous(breaks = seq(1, 12), \n                     labels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n                                \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")) +\n  scale_y_continuous(breaks = seq(2001, 2016)) +\n  theme(axis.text.x = element_text(angle=90),\n        axis.title = element_blank()) +\n  labs(title = \"Number of UFC events by month\")\n\n\n# heatmap of fights per month\n\nufc.fights.month <- filter(ufc, year < 2017, year > 2000) %>%\n  group_by(event, month, year) %>%\n  summarize(\n    num.fights = max(fight.order)\n  ) %>%\n  group_by(month, year) %>%\n  summarize(\n    num.fights.month = sum(num.fights)\n  ) %>%\n  arrange(year, month)\n\nblank2 <- data.frame(rep(1:12, times = 16), rep(2001:2016, each = 12), 0)\ncolnames(blank2) <- c(\"month\", \"year\", \"num.fights.month\")\n\nufc.fights.month.heatmap <- left_join(blank2, ufc.fights.month, by = c(\"month\", \"year\"))\nufc.fights.month.heatmap$num.fights.month <-\n  ifelse(is.na(ufc.fights.month.heatmap$num.fights.month.y), \n         ufc.fights.month.heatmap$num.fights.month.x, \n         ufc.fights.month.heatmap$num.fights.month.y)\n\nggplot(ufc.fights.month.heatmap, aes(y = year, x = month)) +\n  geom_tile(aes(fill = num.fights.month)) +\n  scale_fill_gradient(name = \"# of fights\",\n                      low = \"yellow2\", high = \"red2\") +\n  theme_bw() + \n  scale_x_continuous(breaks = seq(1, 12), \n                     labels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n                                \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")) +\n  scale_y_continuous(breaks = seq(2001, 2016)) +\n  theme(axis.text.x = element_text(angle=90),\n        axis.title = element_blank()) +\n  labs(title = \"Number of UFC fights by month\")\n\nggplot(ufc.fights.month.heatmap, aes(y = num.fights.month, x = month)) +\n  geom_line(aes(color = factor(year))) +\n  theme_bw() + \n  scale_x_continuous(breaks = seq(1, 12), \n                     labels = c(\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n                                \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")) +\n  theme(axis.text.x = element_text(angle=90),\n        axis.title = element_blank()) +\n  labs(title = \"Number of UFC fights by month\")\n\nggplot(ufc.fights.month.heatmap, aes(x = year, y = num.fights.month)) +\n  geom_line(aes(color = factor(month))) +\n  theme_bw() + \n  scale_x_continuous(breaks = seq(2001, 2016)) +\n  theme(axis.text.x = element_text(angle=90),\n        axis.title = element_blank()) +\n  labs(title = \"Number of UFC fights by month\")\n",
    "created" : 1504191581359.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4147563928",
    "id" : "B2418581",
    "lastKnownWriteTime" : 1504889259,
    "last_content_update" : 1504889259195,
    "path" : "~/Documents/MMAGraphs/UFC.R",
    "project_path" : "UFC.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}